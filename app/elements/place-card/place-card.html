<!--
@license
Copyright (c) 2015 John Schweikert. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="place-card">
  <template>
    <style>
      :host {
        display: block:
      }
      paper-dialog {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        max-width: 100%;
        width: 600px;
        margin: 0 auto;
        overflow: initial !important; /* override paper-dialog */
        background: var(--text-primary-color);
      }
      paper-dialog paper-fab {
        margin: 0;
        position: absolute;
        right: 16px;
        top: calc(-56px / 2);
/*        --paper-fab-background: var(--paper-green-500);
        --paper-fab-keyboard-focus-background: var(--paper-green-700);*/
      }
      #card-title {
        margin-left: calc(56px); /* icon width*/
      }
      
      #card-title h2 {
        @apply(--paper-font-headline);
        margin-bottom: 8px;
      }
      
      #card-title h3 {
        @apply(--paper-font-subhead);
        margin-bottom: 8px;
      }
      
      #map {
        position: absolute;
        right: 10px;
        top: 10px;
        width: 150px;
        height: 150px;
        margin: 10px;
      }
      
      iron-icon[item-icon] {
        opacity: var(--dark-secondary-opacity);
      }
      
      .away {
        padding: 8px 0;
        color: var(--paper-light-blue-700);
        border-top: 1px solid var(--paper-grey-300);
        border-bottom: 1px solid var(--paper-grey-300);
        margin-top: 20px;
}

    </style>

      <paper-dialog id="dialog"
          entry-animation="slide-up-and-fade-animation"
          exit-animation="slide-down-and-fade-animation" on-click="_eatClick">
      <header id="card-title">
        <h2><span>[[place.name}}</span>,&nbsp;<span>[[place.state]]</span></h2>
        <h3>[[place.county}}</h3>
        <div class="away"><span>[[_getDistanceFromHere(myLocation, place)]]</span>&nbsp;miles</div>
      </header>
      
      <google-map id="map" latitude="[[place.lat]]" longitude="[[place.lng]]" zoom=12 mapType="hybrid"></google-map>


      <paper-fab icon="maps:directions-car" on-tap="_showDirections"></paper-fab>
      
      <paper-icon-item>
        <iron-icon icon="maps:place" item-icon></iron-icon>
        <span>[[place.lat]]</span>,&nbsp;<span>{{place.lng]]</span>
      </paper-icon-item>

<!--
      <paper-icon-item>
        <iron-icon icon="communication:phone" item-icon></iron-icon>
        <span>{{marker.formatted_phone_number}}</span>
      </paper-icon-item>
      <paper-icon-item class="layout horizontal start"
          hidden$="{{!marker.opening_hours.weekday_text.length}}">
        <iron-icon icon="device:access-time" item-icon></iron-icon>
        <div class="layout vertical">
          <template is="dom-repeat"
                    items="{{marker.opening_hours.weekday_text}}" as="day">
            <div>{{day}}</div>
          </template>
        </div>
      </paper-icon-item>
-->


</paper-dialog>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'place-card',
  
      properties: {
        myLocation: { type: Object },
  
        place: { type: Object },
        
        _distance: {
          type: Number,
          computed: '_getDistanceFromHere(myLocation, place)'
        },
  
        dismissOnOutsideClick: {
          type: Boolean,
          value: true,
          observer: '_onDismissOnClickOutsideChanged'
        }
        
      },
    
      _getDistanceFromHere: function() {

        console.log ('GetDistance From Here' + (typeof google));
        if ((typeof google === 'undefined') || (!this.myLocation) || (!this.place)) {
          return;
        }
        else {
          console.log('calculating distance');
          return Math.round(google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(this.myLocation.lat, this.myLocation.lng), new google.maps.LatLng(this.place.lat, this.place.lng)) * 0.000621371);
        }
      },
      
      open: function() {
        this.$.dialog.animationConfig = {
          entry: {
            name: 'transform-animation',
            node: this.$.dialog,
            transformFrom: 'translateY(calc(100% + 56px/2))',
            transformTo: 'translateY(0)'
          },
          exit: {
            name: 'transform-animation',
            node: this.$.dialog,
            transformFrom: 'translateY(0)',
            transformTo: 'translateY(calc(100% + 56px/2))'
          }
        };
  
        this.$.dialog.open();
      },
      
      close: function() {
        this.$.dialog.close();
      },
      
      _showDirections: function() {
        this.fire('show-directions');
      },
      
      _computeDurationStr: function(duration) {
        return duration ? duration + ' away' : 'Unknown distance from you';
      },
      
      _onDismissOnClickOutsideChanged: function() {
        this.$.dialog.noCancelOnOutsideClick = this.dismissOnOutsideClick;
      },
      
      _eatClick: function(e) {
        e.stopPropagation();
      }

    });
  })();
  </script>
</dom-module>
